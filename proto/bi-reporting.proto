/*
Â© 2025 Sharon Aicler (saichler@gmail.com)

Layer 8 Ecosystem is licensed under the Apache License, Version 2.0.
You may obtain a copy of the License at:

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
syntax = "proto3";

package bi;

option go_package = "./types/bi";

import "bi-common.proto";
import "erp-common.proto";
import "api.proto";

// ============================================================================
// REPORTING MESSAGES
// ============================================================================

// @PrimeObject
// BiReport represents a report definition
message BiReport {
  string report_id = 1;
  string code = 2;
  string name = 3;
  string description = 4;
  BiReportType report_type = 5;
  BiReportStatus status = 6;
  string category = 7;
  string owner_id = 8;                      // cross-ref: HCM Employee
  string data_source_id = 9;                // cross-ref: BiDataSource
  string template_id = 10;                  // cross-ref: BiReportTemplate
  string query = 11;
  BiExportFormat default_format = 12;
  bool is_public = 13;
  int64 last_executed = 14;
  int32 execution_count = 15;
  map<string, string> parameters = 16;
  map<string, string> custom_fields = 17;
  repeated BiReportExecution executions = 19;
  repeated BiReportAccess access_controls = 20;
  repeated BiReportSubscription subscriptions = 21;
  repeated BiReportSchedule schedules = 22;
  erp.AuditInfo audit_info = 18;
}

message BiReportList {
  repeated BiReport list = 1;
  l8api.L8MetaData metadata = 2;
}

// @PrimeObject
// BiReportTemplate represents a report template
message BiReportTemplate {
  string template_id = 1;
  string name = 2;
  string description = 3;
  BiReportType report_type = 4;
  string category = 5;
  string layout_template = 6;
  string style_template = 7;
  bool is_active = 8;
  map<string, string> custom_fields = 9;
  erp.AuditInfo audit_info = 10;
}

message BiReportTemplateList {
  repeated BiReportTemplate list = 1;
  l8api.L8MetaData metadata = 2;
}

// BiReportSchedule represents a report schedule
message BiReportSchedule {
  string schedule_id = 1;
  string name = 3;
  string description = 4;
  BiScheduleFrequency frequency = 5;
  int64 start_date = 6;
  int64 end_date = 7;
  string run_time = 8;                      // Time of day to run (HH:MM)
  int32 day_of_week = 9;                    // 0-6 for weekly schedules
  int32 day_of_month = 10;                  // 1-31 for monthly schedules
  int64 next_run = 11;
  int64 last_run = 12;
  BiExportFormat output_format = 13;
  string delivery_email = 14;
  bool is_active = 15;
  map<string, string> parameters = 16;
  map<string, string> custom_fields = 17;
  erp.AuditInfo audit_info = 18;
}

// BiReportExecution represents a report execution record
message BiReportExecution {
  string execution_id = 1;
  string schedule_id = 3;                   // cross-ref: BiReportSchedule (optional)
  BiExecutionStatus status = 4;
  int64 start_time = 5;
  int64 end_time = 6;
  string executed_by = 7;                   // cross-ref: HCM Employee
  int32 row_count = 8;
  int64 file_size = 9;
  string output_path = 10;
  BiExportFormat output_format = 11;
  string error_message = 12;
  map<string, string> parameters = 13;
  map<string, string> custom_fields = 14;
  erp.AuditInfo audit_info = 15;
}

// BiReportAccess represents report access control
message BiReportAccess {
  string access_id = 1;
  string principal_id = 3;                  // User or Role ID
  string principal_type = 4;                // "USER" or "ROLE"
  BiAccessLevel access_level = 5;
  int64 granted_date = 6;
  string granted_by = 7;                    // cross-ref: HCM Employee
  int64 expiry_date = 8;
  map<string, string> custom_fields = 9;
  erp.AuditInfo audit_info = 10;
}

// BiReportSubscription represents a report subscription
message BiReportSubscription {
  string subscription_id = 1;
  string schedule_id = 3;                   // cross-ref: BiReportSchedule
  string subscriber_id = 4;                 // cross-ref: HCM Employee
  BiExportFormat format = 5;
  string delivery_email = 6;
  bool include_empty = 7;
  bool is_active = 8;
  map<string, string> custom_fields = 9;
  erp.AuditInfo audit_info = 10;
}
